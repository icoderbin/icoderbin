<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Android通知Notification详解 | icoderbin 的小站</title><meta name="author" content="icoderbin"><meta name="copyright" content="icoderbin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="通知是 Android 在应用程序 UI 外部显示的消息，用于向用户提供提醒、其他人的通信或应用程序中的其他及时信息。用户可以点击通知来打开您的应用程序或直接从通知中执行操作。 下面详细介绍一下通知的使用。 权限Android 12及以下不需要申请通知权限，默认APP安装以后就会自动开启通知权限，这"><link rel="shortcut icon" href="/css/icon.png"><link rel="canonical" href="https://icoderbin.github.io/posts/61253/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Android通知Notification详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-01 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/pic.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/css/icon.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">80</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="icoderbin 的小站"><span class="site-name">icoderbin 的小站</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Android通知Notification详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">更新于</span><time datetime="2023-03-31T16:00:00.000Z" title="更新于 2023-04-01 00:00:00">2023-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/android/">android</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/android/Android%E9%80%9A%E7%9F%A5Notification%E8%AF%A6%E8%A7%A3/">Android通知Notification详解</a></span></div><div class="meta-secondline"></div></div></div><article class="post-content" id="article-container"><p>通知是 Android 在应用程序 UI 外部显示的消息，用于向用户提供提醒、其他人的通信或应用程序中的其他及时信息。用户可以点击通知来打开您的应用程序或直接从通知中执行操作。</p>
<p>下面详细介绍一下通知的使用。</p>
<h1 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h1><p>Android 12及以下不需要申请通知权限，默认APP安装以后就会自动开启通知权限，这样用户可以直接创建并发送通知。如果用户想要关闭该APP的通知权限，那么需要进入APP的设置页关闭通知的权限。</p>
<p>Android 13 修改通知权限为运行时权限，也就是说如果想要发出通知，必须主动去申请通知权限，如果用户拒绝，那么通知权限就是关闭的。</p>
<p>针对Android 13，首先声明权限:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.POST_NOTIFICATIONS&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>其次通知权限的运行时权限申请和其他权限是一样的。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> REQ_CODE = <span class="number">111</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">reqPermission</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">33</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.POST_NOTIFICATIONS) == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            <span class="comment">// 已经有权限了，</span></span><br><span class="line">            sendNotification()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            requestPermissions(arrayOf(Manifest.permission.POST_NOTIFICATIONS), REQ_CODE)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onRequestPermissionsResult</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    requestCode: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    permissions: <span class="type">Array</span>&lt;<span class="type">out</span> <span class="type">String</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    grantResults: <span class="type">IntArray</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults)</span><br><span class="line">    <span class="keyword">if</span> (requestCode == REQ_CODE) &#123;</span><br><span class="line">        <span class="keyword">if</span> (grantResults.isNotEmpty() &amp;&amp; grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            sendNotification()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;权限申请失败&quot;</span>, Toast.LENGTH_LONG).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/posts/61253/image1.jpg"></p>
<p>弹出的权限申请弹框，要么允许、要么不允许、要么点击弹框外因此该弹框（等同于不允许）。</p>
<ul>
<li>允许权限： 所有类型的通知都能发送</li>
<li>不允许权限：应用将无法发送通知，除非它符合豁免条件。除少数特定角色外，所有通知渠道均被阻止。这类似于用户在系统设置中手动关闭应用程序的所有通知时发生的行为。</li>
</ul>
<blockquote>
<p>如果你的工程targetsdk版本是Android 13及以上，那么在哪弹出权限弹框是由你完全自定义的。但是如果工程的targetsdk在 Android 13以下，那么弹出权限弹框的时机为当APP在创建通知channel后首次启动 Activity 时，或者当APP启动 Activity 然后创建其第一个通知channel时，系统会显示权限对话框。这通常是在应用程序启动时发生的。</p>
</blockquote>
<h1 id="通知的渠道"><a href="#通知的渠道" class="headerlink" title="通知的渠道"></a>通知的渠道</h1><h2 id="创建通知渠道"><a href="#创建通知渠道" class="headerlink" title="创建通知渠道"></a>创建通知渠道</h2><p>从Android 8 开始 (API26), 所有的通知都必须要设置一个渠道，渠道里的通知可以有相同的属性，通知方式等。如下为创建一个通知渠道的基本流程。</p>
<ul>
<li>使用 <code>NotificationChannel</code> 创建一个渠道的实例，构造函数传入 渠道id、渠道名称、渠道的重要程度。</li>
<li>设置渠道的一些详细信息</li>
<li>获取系统服务 <code>NotificationManager</code>，调用<code>createNotificationChannel()</code> 方法创建这个渠道。</li>
</ul>
<p>下面是代码示例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createChannel</span><span class="params">()</span></span> &#123;</span><br><span class="line">    createNotificationChannel(<span class="string">&quot;default_channel&quot;</span>, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is a default channel&quot;</span>)</span><br><span class="line">    createNotificationChannel(<span class="string">&quot;second_channel&quot;</span>, <span class="string">&quot;second&quot;</span>, <span class="string">&quot;this is second channel&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传入渠道id、名称、描述</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotificationChannel</span><span class="params">(channelId: <span class="type">String</span>, channelName: <span class="type">String</span>, channelDesc: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">        <span class="comment">// 设置渠道的重要成都</span></span><br><span class="line">        <span class="keyword">val</span> channelImportance = NotificationManager.IMPORTANCE_DEFAULT</span><br><span class="line">        <span class="keyword">val</span> channel = NotificationChannel(channelId, channelName, channelImportance)</span><br><span class="line">        channel.description = channelDesc</span><br><span class="line">        <span class="keyword">val</span> notificationManager = getSystemService(NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        notificationManager.createNotificationChannel(channel)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行代码以后，Android 13以下的手机出现三个渠道，如下所示：</p>
<p><img src="/posts/61253/image2.jpg"></p>
<p>android13 及以上的设备出现两个渠道。</p>
<p><img src="/posts/61253/image3.jpg"></p>
<p>点进渠道以后，可以对渠道内的通知进行各种自定义的设置，如下所示：</p>
<p><img src="/posts/61253/image4.jpg"></p>
<blockquote>
<p>相同的渠道可以多次调用创建，调用后也只会创建一次，所以在APP每次一启动时就创建渠道是没有问题的。</p>
</blockquote>
<p>可以自定义渠道的一些默认行为。</p>
<ul>
<li>enableLights(boolean): 设置发布到此频道的通知是否应在支持该功能的设备上显示通知灯。只能在通道提交到 之前修改</li>
<li>enableVibration(boolean): 设置发布到此频道的通知是否应该振动。</li>
<li>setVibrationPattern(long[]): 设置发布到该频道的通知的振动模式。不设置的话使用默认震动。</li>
<li>setShowBadge(boolean): 设置发布到此频道的通知是否可以在启动器中显示为应用程序图标。</li>
</ul>
<p>在创建渠道的时候需要指定渠道的重要性级别，为了兼容Android8以下的设备，需要在设置渠道重要级别的同时也设置一下通知的重要级别。</p>
<ul>
<li><code>IMPORTANCE_HIGH</code>(对应通知的<code>PRIORITY_HIGH</code>或<code> PRIORITY_MAX</code>级别)，会发出声音，且直接弹出通知</li>
<li><code>IMPORTANCE_DEFAULT</code>（对应通知的<code>PRIORITY_DEFAULT</code>级别），会发出声音</li>
<li><code>IMPORTANCE_LOW</code>（对应通知的<code>PRIORITY_LOW</code>级别），没有声音，但是会出现在状态栏</li>
<li><code>IMPORTANCE_MIN</code>（对应通知的<code>PRIORITY_MIN</code>级别），没有声音，也不会出现在状态栏</li>
<li><code>IMPORTANCE_NONE</code>（通知无此级别），没有声音，也不会出现在状态栏，也不会在任何地方</li>
</ul>
<blockquote>
<p>一旦渠道被创建出来，开发者就不能通过代码更改渠道的优先级等数据。但是用户可以在通知的设置页随时修改。</p>
</blockquote>
<h2 id="获取渠道信息"><a href="#获取渠道信息" class="headerlink" title="获取渠道信息"></a>获取渠道信息</h2><p>用户可以通过创建时使用的channelId来获取当前已经创建的通知渠道，然后获取到通知渠道的一些配置。</p>
<ul>
<li>第一步，获取系统服务NotificationManager</li>
<li>第二步，通过系统服务和channelId获取已经创建的渠道</li>
<li>第三步，根据需要获取已设置的参数。比如<code>getVibrationPattern()</code>、<code>getSound()</code>、、<code>getImportance()</code></li>
</ul>
<p>如果获取的某项设置和你的预期不符，那么可以通过打开渠道设置页来引导用户手动修改渠道的各个参数。</p>
<h2 id="打开渠道设置页"><a href="#打开渠道设置页" class="headerlink" title="打开渠道设置页"></a>打开渠道设置页</h2><p>如之前说的那样，创建渠道以后，就无法再通过代码修改渠道里的各个参数。那么如果设置的参数不符合开发者的预期的话，就需要引导用户打开渠道设置页来让用户手动修改了。如下代码所示能够打开渠道设置页。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">openChannelSetting</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">        <span class="keyword">val</span> intent = Intent(Settings.ACTION_CHANNEL_NOTIFICATION_SETTINGS).apply &#123;</span><br><span class="line">            putExtra(Settings.EXTRA_APP_PACKAGE, packageName)</span><br><span class="line">            putExtra(Settings.EXTRA_CHANNEL_ID, <span class="string">&quot;default_channel&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        startActivity(intent)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="删除通知渠道"><a href="#删除通知渠道" class="headerlink" title="删除通知渠道"></a>删除通知渠道</h2><p>可以通过系统服务NotificationManager来删除某个已经创建的渠道。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">deleteChannel</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">        <span class="keyword">val</span> notificationManager = getSystemService(NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        notificationManager.deleteNotificationChannel(<span class="string">&quot;default_channel&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建通知渠道组"><a href="#创建通知渠道组" class="headerlink" title="创建通知渠道组"></a>创建通知渠道组</h2><p>对于一些APP，不同的用户账户登录可能需要不同的渠道设置，比如说一个社交网络的APP，私人账户和企业账户可能需要不同的通知设置，那么就可以通过创建渠道组来处理。如下所示创建多个渠道组，并将创建的渠道关联到对应的渠道组中。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createGroupAndChannel</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 创建两个渠道组</span></span><br><span class="line">    createNotificationChannelGroup(<span class="string">&quot;groupId01&quot;</span>, <span class="string">&quot;groupName01&quot;</span>)</span><br><span class="line">    createNotificationChannelGroup(<span class="string">&quot;groupId02&quot;</span>, <span class="string">&quot;groupName02&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建两个渠道,关联到groupId01的渠道组</span></span><br><span class="line">    createNotificationChannel(<span class="string">&quot;default_channel&quot;</span>, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is a default channel&quot;</span>, <span class="string">&quot;groupId01&quot;</span>)</span><br><span class="line">    createNotificationChannel(<span class="string">&quot;second_channel&quot;</span>, <span class="string">&quot;second&quot;</span>, <span class="string">&quot;this is second channel&quot;</span>, <span class="string">&quot;groupId02&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建两个渠道,关联到groupId02的渠道组</span></span><br><span class="line">    createNotificationChannel(<span class="string">&quot;default_channel&quot;</span>, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is a default channel&quot;</span>, <span class="string">&quot;groupId01&quot;</span>)</span><br><span class="line">    createNotificationChannel(<span class="string">&quot;third_channel&quot;</span>, <span class="string">&quot;third&quot;</span>, <span class="string">&quot;this is third channel&quot;</span>, <span class="string">&quot;groupId01&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotificationChannelGroup</span><span class="params">(groupId: <span class="type">String</span>, groupName: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">        <span class="keyword">val</span> notificationManager = getSystemService(NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        notificationManager.createNotificationChannelGroup(NotificationChannelGroup(groupId, groupName))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotificationChannel</span><span class="params">(channelId: <span class="type">String</span>, channelName: <span class="type">String</span>, channelDesc: <span class="type">String</span>, groupId: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">        <span class="keyword">val</span> channelImportance = NotificationManager.IMPORTANCE_DEFAULT</span><br><span class="line">        <span class="keyword">val</span> channel = NotificationChannel(channelId, channelName, channelImportance)</span><br><span class="line">        channel.description = channelDesc</span><br><span class="line">        channel.enableLights(<span class="literal">true</span>)</span><br><span class="line">        channel.vibrationPattern</span><br><span class="line">        channel.lightColor = Color.RED</span><br><span class="line">        channel.group = groupId</span><br><span class="line">        <span class="keyword">val</span> notificationManager = getSystemService(NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        notificationManager.createNotificationChannel(channel)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建完成以后，在通知设置页会有如下的显示</p>
<p><img src="/posts/61253/image5.jpg"></p>
<h1 id="创建通知"><a href="#创建通知" class="headerlink" title="创建通知"></a>创建通知</h1><p>通知有许多种类型，下面分别介绍一下各种通知类型是怎么创建的。</p>
<h2 id="基本通知"><a href="#基本通知" class="headerlink" title="基本通知"></a>基本通知</h2><p>创建基本通知大致分为以下几个步骤：</p>
<ul>
<li>创建通知渠道</li>
<li>设置通知的内容</li>
<li>设置通知的点击跳转</li>
<li>显示通知</li>
</ul>
<p>如下代码示例创建了一个普通的通知：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建通知</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotification</span><span class="params">(notificationId: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 第一步，创建通知渠道</span></span><br><span class="line">    <span class="keyword">val</span> channelId = <span class="string">&quot;default_channel&quot;</span></span><br><span class="line">    createNotificationChannel(channelId, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is default channel&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二步，设置通知内容，并将创建的渠道关联到通知上</span></span><br><span class="line">    <span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">        .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;这是标题标题&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，&quot;</span>)</span><br><span class="line">        .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第三步，设置通知的点击跳转逻辑</span></span><br><span class="line">    <span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, SecondActivity::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">        flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK</span><br><span class="line">        putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;info&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>,<span class="number">0</span>, intent, PendingIntent.FLAG_IMMUTABLE)</span><br><span class="line">    builder.setContentIntent(pendingIntent)</span><br><span class="line">        .setAutoCancel(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第四步，显示通知，实际上调用的还是notificationManager.notify()</span></span><br><span class="line">    NotificationManagerCompat.from(<span class="keyword">this</span>).notify(notificationId, builder.build())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建通知渠道</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotificationChannel</span><span class="params">(channelId: <span class="type">String</span>, channelName: <span class="type">String</span>, channelDesc: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">        <span class="keyword">val</span> channelImportance = NotificationManager.IMPORTANCE_DEFAULT</span><br><span class="line">        <span class="keyword">val</span> channel = NotificationChannel(channelId, channelName, channelImportance)</span><br><span class="line">        channel.description = channelDesc</span><br><span class="line">        channel.enableLights(<span class="literal">true</span>)</span><br><span class="line">        channel.vibrationPattern</span><br><span class="line">        channel.lightColor = Color.RED</span><br><span class="line">        <span class="keyword">val</span> notificationManager = getSystemService(NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        notificationManager.createNotificationChannel(channel)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用createNotification方法后就会显示出一个通知。</p>
<p><img src="/posts/61253/image6.jpg"></p>
<p>点击通知以后，会跳转到SecondActivity。通过<code>intent.getStringExtra(&quot;data&quot;)</code> 也能获取到点击跳转时所携带的信息。</p>
<p>下面是官方文档所提供的关于这个普通通知的一个介绍。</p>
<p><img src="/posts/61253/image7.jpg"></p>
<ol>
<li>小图标：必填；设置使用 setSmallIcon().</li>
<li>应用名称：由系统提供。</li>
<li>时间戳：由系统提供，但您可以使用 覆盖它 setWhen() 或使用 隐藏它 setShowWhen(false)。</li>
<li>大图标：可选；通常仅用于联系人照片。不要将其用于您的应用程序图标。设置使用 setLargeIcon().</li>
<li>标题：可选；设置使用 setContentTitle().</li>
<li>文本：可选；设置使用 setContentText().</li>
</ol>
<h2 id="通知添加操作按钮"><a href="#通知添加操作按钮" class="headerlink" title="通知添加操作按钮"></a>通知添加操作按钮</h2><p>可以给通知上添加操作按钮，最多可以添加三个。操作按钮的具体操作可以通过广播的形式发出来。如下代码所示。</p>
<p>首先新建一个广播，用来接受按钮的点击消息。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyBroadcastReceiver</span> : <span class="type">BroadcastReceiver</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        Log.i(<span class="string">&quot;MyBroadcastReceiver&quot;</span>, <span class="string">&quot;action=<span class="subst">$&#123;intent?.action&#125;</span>, data=<span class="subst">$&#123;intent?.getStringExtra(<span class="string">&quot;data&quot;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>app启动的时候注册广播：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">registerBroadcast</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> intentFilter = IntentFilter()</span><br><span class="line">    intentFilter.addAction(<span class="string">&quot;action_download&quot;</span>)</span><br><span class="line">    intentFilter.addAction(<span class="string">&quot;action_back&quot;</span>)</span><br><span class="line">    intentFilter.addAction(<span class="string">&quot;action_forward&quot;</span>)</span><br><span class="line">    registerReceiver(MyBroadcastReceiver(), intentFilter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给消息添加按钮操作:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> downloadIntent = Intent(<span class="keyword">this</span>, MyBroadcastReceiver::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">    action = <span class="string">&quot;action_download&quot;</span></span><br><span class="line">    putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;download_url&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> backIntent = Intent(<span class="keyword">this</span>, MyBroadcastReceiver::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">    action = <span class="string">&quot;action_back&quot;</span></span><br><span class="line">    putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;back_url&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> forwardIntent = Intent(<span class="keyword">this</span>, MyBroadcastReceiver::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">    action = <span class="string">&quot;action_forward&quot;</span></span><br><span class="line">    putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;forward_url&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第二步，设置通知内容，并将创建的渠道关联到通知上</span></span><br><span class="line"><span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">    .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">    .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">    .setContentText(<span class="string">&quot;小文本内容，小文本内容&quot;</span>)</span><br><span class="line">    .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">    .addAction(R.drawable.icon_download, <span class="string">&quot;下载&quot;</span>, PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, downloadIntent, <span class="number">0</span>))</span><br><span class="line">    .addAction(R.drawable.icon_back, <span class="string">&quot;上一首&quot;</span>, PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, backIntent, <span class="number">0</span>))</span><br><span class="line">    .addAction(R.drawable.icon_forward, <span class="string">&quot;下一首&quot;</span>, PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, forwardIntent, <span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<p>如上代码所示，添加了三个按钮，点击添加的按钮会触发广播MyBroadcastReceiver，随后可以在广播中处理这些行为。</p>
<p>如下为添加按钮以后的消息样式：</p>
<p><img src="/posts/61253/image13.jpg"></p>
<h2 id="添加进度条"><a href="#添加进度条" class="headerlink" title="添加进度条"></a>添加进度条</h2><p>可以在通知栏添加进度条，主要是调用<code>builder.setProgress(100,0, false)</code> 来启动通知的进度条。当进度条接受的时候调用<code>builder.setProgress(0, 0, false)</code>来结束进度条。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotification</span><span class="params">(notificationId: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 第一步，创建通知渠道</span></span><br><span class="line">    <span class="keyword">val</span> channelId = <span class="string">&quot;default_channel&quot;</span></span><br><span class="line">    createNotificationChannel(channelId, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is default channel&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二步，设置通知内容，并将创建的渠道关联到通知上</span></span><br><span class="line">    <span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">        .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;小文本内容，小文本内容&quot;</span>)</span><br><span class="line">        .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">        .setProgress(<span class="number">100</span>,<span class="number">0</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第三步，设置通知的点击跳转逻辑</span></span><br><span class="line">    <span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, SecondActivity::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">        flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK</span><br><span class="line">        putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;info&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>,<span class="number">0</span>, intent, PendingIntent.FLAG_IMMUTABLE)</span><br><span class="line">    builder.setContentIntent(pendingIntent)</span><br><span class="line">        .setAutoCancel(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第四步，显示通知，实际上调用的还是notificationManager.notify()</span></span><br><span class="line">    NotificationManagerCompat.from(<span class="keyword">this</span>).notify(notificationId, builder.build())</span><br><span class="line">    Thread&#123;</span><br><span class="line">        <span class="comment">// 在子线程中不断更新进度条的进度</span></span><br><span class="line">        <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>)</span><br><span class="line">            builder.setProgress(<span class="number">100</span>, count, <span class="literal">false</span>)</span><br><span class="line">            builder.setContentText(<span class="string">&quot;进度<span class="subst">$&#123;count&#125;</span>%&quot;</span>)</span><br><span class="line">            NotificationManagerCompat.from(<span class="keyword">this</span>).notify(notificationId, builder.build())</span><br><span class="line">            count += <span class="number">10</span></span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                builder.setProgress(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>)</span><br><span class="line">                NotificationManagerCompat.from(<span class="keyword">this</span>).notify(notificationId, builder.build())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下为示例图：</p>
<p><img src="/posts/61253/image14.jpg"></p>
<h2 id="添加直接回复操作"><a href="#添加直接回复操作" class="headerlink" title="添加直接回复操作"></a>添加直接回复操作</h2><p>用户可以在通知里直接呼出输入框并进行消息回复。如下所示为代码示例。</p>
<p>创建可回复消息的通知，点击发送的时候消息由广播接收。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotification</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 第一步，创建通知渠道</span></span><br><span class="line">    <span class="keyword">val</span> channelId = <span class="string">&quot;default_channel&quot;</span></span><br><span class="line">    createNotificationChannel(channelId, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is default channel&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二步，设置通知内容，并将创建的渠道关联到通知上</span></span><br><span class="line">    <span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">        .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;小文本内容，小文本内容&quot;</span>)</span><br><span class="line">        .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建用户回复消息的文本框</span></span><br><span class="line">    <span class="keyword">var</span> remoteInput: RemoteInput = RemoteInput.Builder(<span class="string">&quot;key_text_reply&quot;</span>).run &#123;</span><br><span class="line">        setLabel(<span class="string">&quot;回复&quot;</span>)</span><br><span class="line">        build()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第三步，设置通知的点击跳转逻辑</span></span><br><span class="line">    <span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, MyBroadcastReceiver::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> pendingIntent = PendingIntent.getBroadcast(<span class="keyword">this</span>,<span class="number">111</span>, intent, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    builder.addAction(NotificationCompat.Action.Builder(R.drawable.icon_forward, <span class="string">&quot;回复&quot;</span>, pendingIntent)</span><br><span class="line">        .addRemoteInput(remoteInput)</span><br><span class="line">        .build())</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第四步，显示通知，实际上调用的还是notificationManager.notify()</span></span><br><span class="line">    NotificationManagerCompat.from(<span class="keyword">this</span>).notify(<span class="number">999</span>, builder.build())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下为广播接收的代码，广播接收完成后可以更新通知的显示，表示回复成功。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyBroadcastReceiver</span> : <span class="type">BroadcastReceiver</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取回复的消息</span></span><br><span class="line">        Log.i(<span class="string">&quot;MyBroadcastReceiver&quot;</span>, <span class="string">&quot;text=<span class="subst">$&#123;RemoteInput.getResultsFromIntent(intent)?.getCharSequence(<span class="string">&quot;key_text_reply&quot;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> builder = NotificationCompat.Builder(context!!, <span class="string">&quot;default_channel&quot;</span>)</span><br><span class="line">            .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">            .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">            .setContentText(<span class="string">&quot;回复成功&quot;</span>)</span><br><span class="line">            .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">        NotificationManagerCompat.from(context).notify(<span class="number">999</span>, builder.build())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/61253/image15.jpg"></p>
<h2 id="多样式通知"><a href="#多样式通知" class="headerlink" title="多样式通知"></a>多样式通知</h2><h3 id="文本展开式通知"><a href="#文本展开式通知" class="headerlink" title="文本展开式通知"></a>文本展开式通知</h3><p>可以通过builder.Style()创建文本展开式的通知。上面的普通通知里，文本内容过长的情况下被折叠了，如果不想要被折叠，可以传入<code>NotificationCompat.BigTextStyle()</code> 的通知类型。如下代码所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> contentStr = <span class="string">&quot;这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，&quot;</span> +</span><br><span class="line">                <span class="string">&quot;这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，&quot;</span> +</span><br><span class="line">                <span class="string">&quot;这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，&quot;</span> +</span><br><span class="line">                <span class="string">&quot;这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，&quot;</span> +</span><br><span class="line">                <span class="string">&quot;这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，这是内容，&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步，设置通知内容，并将创建的渠道关联到通知上</span></span><br><span class="line"><span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">    .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">    .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">    .setContentText(<span class="string">&quot;小文本内容，小文本内容&quot;</span>)</span><br><span class="line">    .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">    .setStyle(NotificationCompat.BigTextStyle()</span><br><span class="line">        .bigText(contentStr) <span class="comment">// 设置大文本</span></span><br><span class="line">        .setBigContentTitle(<span class="string">&quot;这是big标题&quot;</span>) <span class="comment">// 大文本通知的标题</span></span><br><span class="line">        .setSummaryText(<span class="string">&quot;标题文本&quot;</span>) <span class="comment">// 显示在第一行的文案</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>如下图片为展示出来的显示大文本的样式，显示出大文本后是可以进行折叠的，折叠后通知的文案和标题会显示为小文本样式设置的文案和标题，如下所示。</p>
<p>这个是大文本展开的UI：</p>
<p><img src="/posts/61253/image8.jpg"></p>
<p>这个是折叠以后的图。<br><img src="/posts/61253/image9.jpg"></p>
<blockquote>
<p>提示：如需对文本添加格式（粗体、斜体、换行等等），您可以使用 HTML 标记添加样式。</p>
</blockquote>
<h3 id="大图片通知"><a href="#大图片通知" class="headerlink" title="大图片通知"></a>大图片通知</h3><p>大图片通知和大文本通知类似，通过<code>builder.Style()</code>传入<code>NotificationCompat.BigPictureStyle()</code>类型便可。如下代码所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bitmap = BitmapFactory.decodeResource(resources,R.drawable.big_picture)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> bigLargeBitmap = BitmapFactory.decodeResource(resources,R.drawable.icon_notification)</span><br><span class="line"><span class="comment">// 第二步，设置通知内容，并将创建的渠道关联到通知上</span></span><br><span class="line"><span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">    .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">    .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">    .setContentText(<span class="string">&quot;小文本内容，小文本内容&quot;</span>)</span><br><span class="line">    .setLargeIcon(bigLargeBitmap)</span><br><span class="line">    .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">    .setStyle(NotificationCompat.BigPictureStyle()</span><br><span class="line">        .setBigContentTitle(<span class="string">&quot;图片标题&quot;</span>)</span><br><span class="line">        .setSummaryText(<span class="string">&quot;标题标题&quot;</span>)</span><br><span class="line">        .bigPicture(bitmap)</span><br><span class="line">        .bigLargeIcon(bigLargeBitmap)</span><br></pre></td></tr></table></figure>

<p>如下为显示的样式。</p>
<p><img src="/posts/61253/image10.jpg"></p>
<h3 id="收件箱样式的通知"><a href="#收件箱样式的通知" class="headerlink" title="收件箱样式的通知"></a>收件箱样式的通知</h3><p>如果想添加多个简短摘要行（例如收到的电子邮件中的摘要），可以通过 NotificationCompat.InboxStyle。这样，可以添加多条内容文本，并且每条文本均截断为一行。</p>
<p>如需添加新行，最多可调用 addLine() 6 次。如果添加的行超过 6 行，仅显示前 6 行。</p>
<p>如下代码所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">    .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">    .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">    .setContentText(<span class="string">&quot;小文本内容，小文本内容&quot;</span>)</span><br><span class="line">    .setLargeIcon(bigLargeBitmap)</span><br><span class="line">    .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">    .setStyle(NotificationCompat.InboxStyle()</span><br><span class="line">        .addLine(<span class="string">&quot;第一行第一行第一行第一行第一行第一行第一行第一行第一行&quot;</span>)</span><br><span class="line">        .addLine(<span class="string">&quot;第二行第二行第二行第二行第二行第二行第二行第二行第二行&quot;</span>)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><img src="/posts/61253/image11.jpg"></p>
<blockquote>
<p>提示：通过使用 HTML 标记添加样式（例如加粗主题），可以区分每行中的消息主题和消息内容。</p>
</blockquote>
<h3 id="在通知中显示对话"><a href="#在通知中显示对话" class="headerlink" title="在通知中显示对话"></a>在通知中显示对话</h3><p>应用通过<code>NotificationCompat.MessagingStyle</code> 可显示任意人数之间依序发送的消息。这是即时通讯应用的理想之选，因为它通过单独处理发送人姓名和消息文本为每条消息提供一致的布局，而且每条消息可以在多行中显示。</p>
<p>如需添加新消息，请调用 addMessage()，并传入消息文本、接收时间和发送人姓名。</p>
<p>如下代码示例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> person01 = Person.Builder()</span><br><span class="line">    .setName(<span class="string">&quot;person01&quot;</span>)</span><br><span class="line">    .setIcon(IconCompat.createWithResource(<span class="keyword">this</span>, R.drawable.icon_notification))</span><br><span class="line">    .setKey(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    .setImportant(<span class="literal">false</span>)</span><br><span class="line">    .setBot(<span class="literal">false</span>)</span><br><span class="line">    .setUri(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">    .build()</span><br><span class="line"><span class="keyword">val</span> person02 = Person.Builder()</span><br><span class="line">    .setName(<span class="string">&quot;person02&quot;</span>)</span><br><span class="line">    .setKey(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">    .setImportant(<span class="literal">true</span>)</span><br><span class="line">    .setBot(<span class="literal">true</span>)</span><br><span class="line">    .setUri(<span class="string">&quot;https://www.google.com&quot;</span>)</span><br><span class="line">    .build()</span><br><span class="line">builder.setStyle(NotificationCompat.MessagingStyle(person01)</span><br><span class="line">    .addMessage(<span class="string">&quot;消息01&quot;</span>, System.currentTimeMillis() - <span class="number">100000</span>, person01)</span><br><span class="line">    .addMessage(<span class="string">&quot;消息02&quot;</span>, System.currentTimeMillis() - <span class="number">1000000</span>, person02)</span><br><span class="line">    .setConversationTitle(<span class="string">&quot;标题标题&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>如下所示为展示样式：</p>
<p><img src="/posts/61253/image12.jpg"></p>
<h3 id="使用媒体控件创建通知"><a href="#使用媒体控件创建通知" class="headerlink" title="使用媒体控件创建通知"></a>使用媒体控件创建通知</h3><p>当我们的应用在播放视频或者音乐的时候，我们可能会需要在通知栏显示当前播放的曲目信息，此时就需要使用媒体控件来创建通知消息。</p>
<p>在使用媒体控件创建通知栏消息的时候，可以通过调用addAction来添加按钮，最多能够添加5个，用于执行不同的操作。同时可以调用setLargeIcon()来设置专辑封面。同时，我们还可以通过setShowActionsInCompactView()来设置通知收起之后仍然要显示的按钮。</p>
<p>同时，如果通知表示媒体会话，则还可以调用setMediaSession()在通知上附加MediaSession.Token，这样，系统就会将其识别为表示媒体会话的通知并相应的做出响应(例如在锁屏中显示专辑封面)</p>
<p>通过如下代码创建媒体控件通知:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotification</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 第一步，创建通知渠道</span></span><br><span class="line">    <span class="keyword">val</span> channelId = <span class="string">&quot;default_channel&quot;</span></span><br><span class="line">    createNotificationChannel(channelId, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is default channel&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> downloadIntent = Intent(<span class="keyword">this</span>, MyBroadcastReceiver::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">        action = <span class="string">&quot;action_download&quot;</span></span><br><span class="line">        putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;download_url&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> backIntent = Intent(<span class="keyword">this</span>, MyBroadcastReceiver::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">        action = <span class="string">&quot;action_back&quot;</span></span><br><span class="line">        putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;back_url&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> forwardIntent = Intent(<span class="keyword">this</span>, MyBroadcastReceiver::<span class="keyword">class</span>.java).apply &#123;</span><br><span class="line">        action = <span class="string">&quot;action_forward&quot;</span></span><br><span class="line">        putExtra(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;forward_url&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 第二步，设置通知内容，并将创建的渠道关联到通知上</span></span><br><span class="line">    <span class="keyword">val</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">        .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;这是small标题&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;小文本内容，小文本内容&quot;</span>)</span><br><span class="line">        .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">        .addAction(R.drawable.icon_download, <span class="string">&quot;下载&quot;</span>, PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, downloadIntent, <span class="number">0</span>))</span><br><span class="line">        .addAction(R.drawable.icon_back, <span class="string">&quot;上一首&quot;</span>, PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, backIntent, <span class="number">0</span>))</span><br><span class="line">        .addAction(R.drawable.icon_forward, <span class="string">&quot;下一首&quot;</span>, PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, forwardIntent, <span class="number">0</span>))</span><br><span class="line">        .setStyle(androidx.media.app.NotificationCompat.MediaStyle()</span><br><span class="line">            .setShowActionsInCompactView(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//                .setMediaSession()</span></span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第四步，显示通知，实际上调用的还是notificationManager.notify()</span></span><br><span class="line">    NotificationManagerCompat.from(<span class="keyword">this</span>).notify(<span class="number">999</span>, builder.build())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，如果项目使用的是androidx，那么在使用MediaStyle的时候可能出现找不到这个类的问题，此时需要导入androidx的media库，包括如下部分:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&quot;androidx.media2:media2-session:1.2.1&quot;</span></span><br><span class="line">implementation <span class="string">&quot;androidx.media2:media2-widget:1.2.1&quot;</span></span><br><span class="line">implementation <span class="string">&quot;androidx.media2:media2-player:1.2.1&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="自定义通知"><a href="#自定义通知" class="headerlink" title="自定义通知"></a>自定义通知</h2><p>可以使用<code>NotificationCompat.DecoratedCustomViewStyle</code> 对通知进行自定义布局</p>
<ul>
<li>setCustomContentView 通过该方法设置折叠的布局。</li>
<li>setCustomBigContentView 通过该方法设置展开的布局。</li>
</ul>
<p>如下代码所示，创建通知，并设置自定义布局</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotification</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 第一步，创建通知渠道</span></span><br><span class="line">    <span class="keyword">val</span> channelId = <span class="string">&quot;default_channel&quot;</span></span><br><span class="line">    createNotificationChannel(channelId, <span class="string">&quot;default&quot;</span>, <span class="string">&quot;this is default channel&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> notifySmallLayout = RemoteViews(packageName, R.layout.notification_small)</span><br><span class="line">    <span class="keyword">val</span> notifyLargeLayout = RemoteViews(packageName, R.layout.notification_large)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> builder =</span><br><span class="line">        NotificationCompat.Builder(<span class="keyword">this</span>, channelId)</span><br><span class="line">            .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">            .setContentTitle(<span class="string">&quot;Incoming call&quot;</span>)</span><br><span class="line">            .setContentText(<span class="string">&quot;(919) 555-1234&quot;</span>)</span><br><span class="line">            .setPriority(NotificationCompat.PRIORITY_HIGH)</span><br><span class="line">            .setLargeIcon(BitmapFactory.decodeResource(resources, R.drawable.icon_notification))</span><br><span class="line">            .setCustomContentView(notifySmallLayout)</span><br><span class="line"><span class="comment">//                .setCustomBigContentView(notifyLargeLayout)</span></span><br><span class="line">            .setStyle(NotificationCompat.DecoratedCustomViewStyle())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    NotificationManagerCompat.from(<span class="keyword">this</span>).notify(<span class="number">999</span>, builder.build())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/61253/image16.jpg"></p>
<h1 id="设置系统范围的类别"><a href="#设置系统范围的类别" class="headerlink" title="设置系统范围的类别"></a>设置系统范围的类别</h1><p>Android 使用一些预定义的系统范围类别来确定当用户启用“ 请勿打扰”模式时是否通过给定通知打扰用户。</p>
<p>如果通知属于中定义的预定义通知类别之一NotificationCompat- 例如CATEGORY_ALARM、 CATEGORY_REMINDER、 CATEGORY_EVENT或 CATEGORY_CALL- 通过将适当的类别传递给来声明它setCategory()。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = NotificationCompat.Builder(<span class="keyword">this</span>, CHANNEL_ID)</span><br><span class="line">        .setSmallIcon(R.drawable.notification_icon)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;My notification&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">        .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">        .setCategory(NotificationCompat.CATEGORY_MESSAGE)</span><br></pre></td></tr></table></figure>

<h1 id="显示紧急消息"><a href="#显示紧急消息" class="headerlink" title="显示紧急消息"></a>显示紧急消息</h1><p>应用程序可能需要显示紧急的、时间敏感的消息，例如来电或闹钟铃声。在这些情况下，可以将全屏意图与通知相关联。调用通知时，用户会看到以下内容之一，具体取决于设备的锁定状态：</p>
<ul>
<li>如果用户的设备被锁定，则会出现全屏活动，覆盖锁定屏幕。</li>
<li>如果用户的设备已解锁，通知将以扩展形式显示，其中包括用于处理或消除通知的选项。</li>
</ul>
<blockquote>
<p>注意：包含全屏意图的通知具有很大的侵入性，因此仅针对最紧急、时间敏感的消息使用此类通知非常重要。</p>
</blockquote>
<blockquote>
<p>注意：如果应用面向 Android 10（API 级别 29）或更高版本，则必须 USE_FULL_SCREEN_INTENT 在应用的清单文件中请求权限，以便系统启动与时间敏感通知关联的全屏 Activity。</p>
</blockquote>
<h1 id="设置锁屏可见性"><a href="#设置锁屏可见性" class="headerlink" title="设置锁屏可见性"></a>设置锁屏可见性</h1><p>要控制锁定屏幕通知中可见的详细信息级别，可以调用setVisibility()并指定以下值之一：</p>
<ul>
<li>VISIBILITY_PUBLIC显示通知的完整内容。</li>
<li>VISIBILITY_SECRET 不会在锁定屏幕上显示此通知的任何部分。</li>
<li>VISIBILITY_PRIVATE 显示基本信息，例如通知的图标和内容标题，但隐藏通知的完整内容。</li>
</ul>
<p>设置后VISIBILITY_PRIVATE，您还可以提供隐藏某些详细信息的通知内容的替代版本。例如，短信应用程序可能会显示一条通知，显示“您有 3 条新短信”，但隐藏了消息内容和发件人。要提供此替代通知，请首先像往常一样创建替代通知NotificationCompat.Builder。然后使用 附加替代通知到正常通知 <code>setPublicVersion()</code>。</p>
<h1 id="更新通知"><a href="#更新通知" class="headerlink" title="更新通知"></a>更新通知</h1><p>要在发出通知后更新此通知，请NotificationManagerCompat.notify()再次调用，并向其传递具有您之前使用的相同 ID 的通知。如果先前的通知已被忽略，则会创建新的通知。</p>
<p>您可以选择调用， <code>setOnlyAlertOnce()</code>以便您的通知仅在通知第一次出现时（通过声音、振动或视觉线索）打断用户，而不会在以后的更新中打断用户。</p>
<h1 id="删除通知"><a href="#删除通知" class="headerlink" title="删除通知"></a>删除通知</h1><p>通知保持可见，直到发生以下情况之一：</p>
<ul>
<li>用户忽略该通知。</li>
<li>用户单击通知，并且您 setAutoCancel()在创建通知时进行了调用。</li>
<li>调用cancel()特定的通知 ID。此方法还会删除正在进行的通知。</li>
<li>调用cancelAll()，这将删除您之前发出的所有通知。</li>
<li>如果在创建通知时设置了超时时间 setTimeoutAfter()，则系统会在指定的时长过后取消通知。如果需要，您可以在指定的超时持续时间过去之前取消通知。</li>
</ul>
<p>可通过<code>setDeleteIntent()</code> 设置通知被删除后的动作。可以通过PendingIntentl来发送一个广播进行统计。</p>
<h1 id="通知组"><a href="#通知组" class="headerlink" title="通知组"></a>通知组</h1><p>从 Android 7.0（API 级别 24）开始，可以将通知分组，分组后的通知会折叠显示，也可以将其展开。如果要支持旧版本，请添加单独显示的摘要通知以汇总所有单独的通知。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createNotificationGroup</span><span class="params">(count: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use constant ID for notifications used as group summary.</span></span><br><span class="line">    <span class="keyword">val</span> SUMMARY_ID = <span class="number">999</span></span><br><span class="line">    <span class="keyword">val</span> GROUP_KEY_WORK_EMAIL = <span class="string">&quot;com.android.example.WORK_EMAIL&quot;</span></span><br><span class="line">    <span class="keyword">val</span> CHANNEL_ID = <span class="string">&quot;default_channel&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> newMessageNotification1 = NotificationCompat.Builder(<span class="keyword">this</span><span class="symbol">@MainActivity</span>, CHANNEL_ID)</span><br><span class="line">        .setSmallIcon(R.drawable.icon_notification)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;第一条消息<span class="subst">$&#123;count&#125;</span>&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;第一条消息内容<span class="subst">$&#123;count&#125;</span>&quot;</span>)</span><br><span class="line">        .setGroup(GROUP_KEY_WORK_EMAIL)</span><br><span class="line">        .build()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> newMessageNotification2 = NotificationCompat.Builder(<span class="keyword">this</span><span class="symbol">@MainActivity</span>, CHANNEL_ID)</span><br><span class="line">        .setSmallIcon(R.drawable.icon_back)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;第二条消息<span class="subst">$&#123;count&#125;</span>&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;第二条消息内容<span class="subst">$&#123;count&#125;</span>&quot;</span>)</span><br><span class="line">        .setGroup(GROUP_KEY_WORK_EMAIL)</span><br><span class="line">        .build()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> summaryNotification = NotificationCompat.Builder(<span class="keyword">this</span><span class="symbol">@MainActivity</span>, CHANNEL_ID)</span><br><span class="line"></span><br><span class="line">        .setSmallIcon(R.drawable.icon_download)</span><br><span class="line">        .setGroup(GROUP_KEY_WORK_EMAIL)</span><br><span class="line">        .setGroupSummary(<span class="literal">true</span>)</span><br><span class="line">        .build()</span><br><span class="line"></span><br><span class="line">    NotificationManagerCompat.from(<span class="keyword">this</span>).apply &#123;</span><br><span class="line">        notify(<span class="number">111</span> + count, newMessageNotification1)</span><br><span class="line">        notify(<span class="number">222</span> + count, newMessageNotification2)</span><br><span class="line">        notify(SUMMARY_ID, summaryNotification)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下所示，创建消息组后可以不停地向消息组内增加消息。</p>
<p><img src="/posts/61253/image17.jpg"></p>
<h2 id="坑点"><a href="#坑点" class="headerlink" title="坑点"></a>坑点</h2><p>在开发notification分组的时候，遇到了一个坑。我在Demo程序中，拉下来通知栏，正常的调用上述代码时就能自动折叠起来，但是在工程代码里就不行。后经过反复实验发现是因为通道的权限问题。</p>
<p>如果通道权限设置为<code>IMPORTANCE_DEFAULT</code>， 那么下拉状态下会自动折叠。但是如果通道权限设置为<code>IMPORTANCE_HIGH </code>或者<code>IMPORTANCE_MAX</code> 并不会自动折叠。</p>
<p>参考文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/develop/ui/views/notifications">android 通知官方文档</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://icoderbin.github.io">icoderbin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://icoderbin.github.io/posts/61253/">https://icoderbin.github.io/posts/61253/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://icoderbin.github.io" target="_blank">icoderbin 的小站</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="/css/icon.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/css/wechat.png" target="_blank"><img class="post-qr-code-img" src="/css/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/css/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/css/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/48022/" title="AndResGuard资源混淆源码学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">AndResGuard资源混淆源码学习</div></div></a></div><div class="next-post pull-right"><a href="/posts/3466/" title="Android的resources.arsc文件结构"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Android的resources.arsc文件结构</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90"><span class="toc-number">1.</span> <span class="toc-text">权限</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E7%9A%84%E6%B8%A0%E9%81%93"><span class="toc-number">2.</span> <span class="toc-text">通知的渠道</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%80%9A%E7%9F%A5%E6%B8%A0%E9%81%93"><span class="toc-number">2.1.</span> <span class="toc-text">创建通知渠道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B8%A0%E9%81%93%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.</span> <span class="toc-text">获取渠道信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E6%B8%A0%E9%81%93%E8%AE%BE%E7%BD%AE%E9%A1%B5"><span class="toc-number">2.3.</span> <span class="toc-text">打开渠道设置页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%80%9A%E7%9F%A5%E6%B8%A0%E9%81%93"><span class="toc-number">2.4.</span> <span class="toc-text">删除通知渠道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%80%9A%E7%9F%A5%E6%B8%A0%E9%81%93%E7%BB%84"><span class="toc-number">2.5.</span> <span class="toc-text">创建通知渠道组</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%80%9A%E7%9F%A5"><span class="toc-number">3.</span> <span class="toc-text">创建通知</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%80%9A%E7%9F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">基本通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%8C%89%E9%92%AE"><span class="toc-number">3.2.</span> <span class="toc-text">通知添加操作按钮</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="toc-number">3.3.</span> <span class="toc-text">添加进度条</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%9B%B4%E6%8E%A5%E5%9B%9E%E5%A4%8D%E6%93%8D%E4%BD%9C"><span class="toc-number">3.4.</span> <span class="toc-text">添加直接回复操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%A0%B7%E5%BC%8F%E9%80%9A%E7%9F%A5"><span class="toc-number">3.5.</span> <span class="toc-text">多样式通知</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%B1%95%E5%BC%80%E5%BC%8F%E9%80%9A%E7%9F%A5"><span class="toc-number">3.5.1.</span> <span class="toc-text">文本展开式通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%9B%BE%E7%89%87%E9%80%9A%E7%9F%A5"><span class="toc-number">3.5.2.</span> <span class="toc-text">大图片通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E4%BB%B6%E7%AE%B1%E6%A0%B7%E5%BC%8F%E7%9A%84%E9%80%9A%E7%9F%A5"><span class="toc-number">3.5.3.</span> <span class="toc-text">收件箱样式的通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E9%80%9A%E7%9F%A5%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%AF%B9%E8%AF%9D"><span class="toc-number">3.5.4.</span> <span class="toc-text">在通知中显示对话</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AA%92%E4%BD%93%E6%8E%A7%E4%BB%B6%E5%88%9B%E5%BB%BA%E9%80%9A%E7%9F%A5"><span class="toc-number">3.5.5.</span> <span class="toc-text">使用媒体控件创建通知</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%9A%E7%9F%A5"><span class="toc-number">3.6.</span> <span class="toc-text">自定义通知</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F%E8%8C%83%E5%9B%B4%E7%9A%84%E7%B1%BB%E5%88%AB"><span class="toc-number">4.</span> <span class="toc-text">设置系统范围的类别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E7%B4%A7%E6%80%A5%E6%B6%88%E6%81%AF"><span class="toc-number">5.</span> <span class="toc-text">显示紧急消息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%94%81%E5%B1%8F%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="toc-number">6.</span> <span class="toc-text">设置锁屏可见性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%80%9A%E7%9F%A5"><span class="toc-number">7.</span> <span class="toc-text">更新通知</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%80%9A%E7%9F%A5"><span class="toc-number">8.</span> <span class="toc-text">删除通知</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E7%BB%84"><span class="toc-number">9.</span> <span class="toc-text">通知组</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9D%91%E7%82%B9"><span class="toc-number">9.1.</span> <span class="toc-text">坑点</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>