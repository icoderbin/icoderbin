<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>项目经验 | icoderbin 的小站</title><meta name="robots" content="noindex"><meta name="author" content="icoderbin"><meta name="copyright" content="icoderbin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="项目bigolive核心数据冷启动：50分为数1s,90分位数3s崩溃率：千分之1.6，其中Native占1，Java占0.6卡顿率：1.4%ANR率：1.14%包大小：60M短视频秒出率：96%直播秒出率：90% 主流分辨率：  720_1600 1080_2400  日活： Android 60"><link rel="shortcut icon" href="/css/icon.png"><link rel="canonical" href="https://icoderbin.github.io/posts/11472/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '项目经验',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-01 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/pic.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/css/icon.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">58</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">86</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="icoderbin 的小站"><span class="site-name">icoderbin 的小站</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">项目经验</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">更新于</span><time datetime="2024-03-31T16:00:00.000Z" title="更新于 2024-04-01 00:00:00">2024-04-01</time></span></div><div class="meta-secondline"></div></div></div><article class="post-content" id="article-container"><h1 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h1><h2 id="bigolive核心数据"><a href="#bigolive核心数据" class="headerlink" title="bigolive核心数据"></a>bigolive核心数据</h2><p>冷启动：50分为数1s,90分位数3s<br>崩溃率：千分之1.6，其中Native占1，Java占0.6<br>卡顿率：1.4%<br>ANR率：1.14%<br>包大小：60M<br>短视频秒出率：96%<br>直播秒出率：90%</p>
<p>主流分辨率：</p>
<ul>
<li>720_1600</li>
<li>1080_2400</li>
</ul>
<p>日活： Android 600W日活，iOS 80W日活 </p>
<ul>
<li>菲律宾、 印尼、巴基斯坦、孟加拉、泰国、越南 东南亚用户占60%</li>
<li>美国 5%</li>
<li>俄罗斯 5%</li>
<li>中东</li>
</ul>
<p>机型：三星、小米、vivo、OPPO、realme、传音</p>
<p>系统版本： 13 11 12  14 10</p>
<p>产研600+<br>客户端</p>
<p>Android push推送量在10亿级别<br>android push点击率 19%左右，push展示率75%，端内到达率28%，业务到达率99%<br>android 定位权限开启率 36%，iOS 45%；谷歌定位成功率30%，系统定位成功率23%；剔除掉定位关闭的情况谷歌定位成功率在96%，系统定位成功率在93%。<br>存在没有定位成功的情况：刚启动，无信号等。</p>
<h2 id="c-开发"><a href="#c-开发" class="headerlink" title="c++ 开发"></a>c++ 开发</h2><ul>
<li>anr 检测工具迭代版，开发如何监控ANR信号。</li>
<li>PLT hook的主要是dump ANR trace，核心点是如何找到dump内存的手段。在ANR发生时开始hook，ANR结束后再反hook。通过Socket进行dump trace，因此hook write方法可以获取到。</li>
</ul>
<p>如何监控ANR的？通过sigaction来监控sigquit信号，注意sigquit是阻塞信号，通过sigmark函数改成非阻塞的就可以收到。</p>
<h2 id="音视频"><a href="#音视频" class="headerlink" title="音视频"></a>音视频</h2><p><strong>播放器优化</strong></p>
<ul>
<li>播放器为单例模式的</li>
<li>视频提前下载</li>
<li>使用同一个TextureView。TextureView底层依赖于Surface，Surface的销毁重建会耗时，</li>
<li>首帧预览图由后端生成，下发给客户端，下一屏先展示首帧图。</li>
</ul>
<p><strong>视频截屏和录制</strong></p>
<ul>
<li>视频截屏： 通过GLSurfaceView.Renderer 的onDrawFrame的回调进行对视频流进行处理，然后添加滤镜、美颜、面具等功能，然后如果截屏的的话，在最后处理完成以后，将这一帧数据的Buffer截留下来，然后转化为Bitmap进行存储，然后在渲染流里添加一个白色的闪屏。</li>
</ul>
<h2 id="冷启动优化"><a href="#冷启动优化" class="headerlink" title="冷启动优化"></a>冷启动优化</h2><p><strong>面临的问题</strong></p>
<ul>
<li>接手冷启动优化后，发现最大的问题就是指标劣化。也就是说冷启动优化已经好几年了，中间确实有指标明显下降的阶段，但是总是慢慢的就回到原来的问题上了。所以，需要考虑的不仅是如何把指标降下去，还要考虑到如何将指标稳定下来。</li>
<li>第二个需要考虑的问题是保证其他指标不发生劣化。因为看到有些优化将一些任务堆砌到冷启动结束以后，直接导致的后果就是首屏fps下降，卡顿率上升。所以不能顾此失彼。</li>
<li>第三个问题就是常规的优化手段在前面几轮里用的也差不多了，比如说Activity改Fragment，把一些任务抛到子线程，所以需要综合考虑优化手段。</li>
</ul>
<p><strong>工具</strong></p>
<ul>
<li>Systrace。</li>
<li>方法耗时检测插件，Android Studio上的Profiler不好用，太卡了。自定义的插件能自定义功能。在编译期间通过ASM插桩每个方法的开始和结束，统计每个方法的方法耗时。当然会添加一些方法的过滤规则，比如说set、get这种有可能内联的方法。</li>
</ul>
<p><strong>方案</strong></p>
<p>构建一个轻量级的框架，轻到框架本身不产生任何性能损耗。相比于阿里的alpha，依赖比较少，因此完全无性能上的损耗。</p>
<ul>
<li>之前冷启动的第一个问题：后台并发过多线程，导致线程切换频繁，且包括主线程在内的后台线程都难以争抢到CPU资源导致启动变慢。实验取消掉29个后台线程，冷启动耗时竟然增加了15%，也正是印证了主线程CPU资源被抢占的问题。</li>
<li>CPU在启动阶段的任务繁忙程度是不均匀的，比如说在attachBaseContext到onCreate()主线程虽然一直在执行，但是CPU并发的任务非常少，如果在这里添加一些后台并发任务，完全不影响主线程的执行时间。</li>
<li>因此，框架将冷启动阶段的task氛围以下几类：能否在后台执行，能否在冷启动后执行，能否在onCreate()之前执行。总体的思想就是负载均衡，将初始化任务均匀地在冷启动阶段铺开。另外也需要考虑冷启动以后的任务并发，因为我发现之前的优化，对一些可以在冷启动以后执行的后台任务，在冷启动以后批量并发了，这就导致了首屏卡顿率的提升，因此在考虑优化一个指标的时候，需要慎重考虑对其他指标的影响。</li>
<li>实施起来最大的难点就是需要完整梳理和分类冷启动任务，甚至遇到一些一部分在后台、一部分在UI的任务需要去做拆分。</li>
<li>然后就是考量线程池的数量，刚开始是做了几组实验，然后确定一个初始的线程池数量，然后对线程池数量进行动态调节。因为对于必须要在首屏启动之前完成初始化的任务，在MainActiviy的onCreate()处有个任务等待，等待他们执行完以后再开始执行，在这里获取主线程等待市场，根据时长决定启用多少个线程。</li>
<li>有了这个框架，首先监控变得非常方便，因为是以task为组织的，所以哪个task耗时增加了，或者新增了哪些task都是一目了然。</li>
<li>有了这个框架，就能将很多主线程路径下的价值任务提前加载一次，主线程获取缓存就行。</li>
</ul>
<p>其他的优化手段：</p>
<ul>
<li>ContentProvider 优化</li>
<li>UI渲染优化，将xml异步加载。</li>
<li>Binder优化，减少跨进程调用</li>
<li>高频方法优化</li>
<li>内存缓存等，比如说给MMKV加上一级缓存</li>
</ul>
<p><strong>竞对对比</strong></p>
<ul>
<li>通过录屏的方式进行竞品测试。竞品有抖音、快手、Tik Tok、ins等。录屏后使用potplayer一帧一帧的看数据，确保是体验上的启动。</li>
<li>新安装tiktok  4.7，bigolive 3.4</li>
<li>常规冷启动 tiktok 2.6 ，bigolive 2.3</li>
</ul>
<p><strong>监控指标</strong></p>
<ul>
<li><p>启动时间监控有多重起始点和终止点，如果以业务场景考虑，以attachBaseContext和首屏第一帧。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/3a2FfPKGGHROymH4dOVD_g">字节跳动开源神器：btrace 2.0 技术原理大揭秘</a></p>
</li>
</ul>
<h2 id="包大小优化"><a href="#包大小优化" class="headerlink" title="包大小优化"></a>包大小优化</h2><ul>
<li>包大小优化分了很多个方向：so优化、业务代码优化、redex优化等。我被分配到图片资源优化这个方向独立负责。</li>
<li>接收到这个任务后，发现常规的优化手段也被使用过了，比如说通过McImage库进行编译阶段将资源进行压缩；通过字节的aabresproguard工具对重复图片进行删除。因此需要更有效的方案去解决问题。因此开发了这套图片资源管理框架，并申请了一个发明专利，可以说是基本彻底解决图片资源占用所导致的包大小问题。</li>
<li>通过调研发现6000+张图片资源，实际上在APP运行阶段使用率是很低的，可能一次比较复杂的使用流程下来也就几百张在使用，因此考虑能不能将使用频率低的图片统一打成资源包，然后在运行阶段拉下来使用。设计整个流程的时候需要考虑以下方面：<ul>
<li>不要干扰开发者的开发习惯。打个比方说，正常ImageView设置src然后将图片资源复制到资源目录就行了。如果说强制图片上云，然后以URL的方式下发，可能很多开发者不喜欢这么长的链路，且本地xml开发没有预览效果。因此第一点考虑的就是对普通开发者无感知。</li>
<li>第二点需要考虑的就是避免劣化，因为有时候方案处理完成后，慢慢有劣化了，导致白忙活。</li>
<li>第三点就是线上运行情况的全透明。</li>
</ul>
</li>
<li>框架分为三个阶段，第一个阶段通过脚本收集图片资源打成资源包，上传到云端。</li>
<li>第二个阶段是在进行CI打包的时候通过脚本修改代码实现，并删除图片资源。</li>
<li>第三个阶段就是线上Hook资源的获取流程，将之前从apk安装目录获取资源改为从下载的资源包中获取资源。<ul>
<li>接管LoaderApk中的Resources</li>
<li>接管BaseContext的Resources</li>
<li>接管Activity中的Resources</li>
</ul>
</li>
</ul>
<p><strong>难点</strong></p>
<ul>
<li>屏幕适配：因为在不同目录下图片显示压缩的比例是不一样的，因此需要根据此进行适配。</li>
<li>资源id固定。为了匹配上资源id和资源名称，需要对资源id进行固定。</li>
</ul>
<h2 id="ANR"><a href="#ANR" class="headerlink" title="ANR"></a>ANR</h2><p><strong>什么时候会发生ANR</strong></p>
<ul>
<li>Service Timeout:比如前台服务在20s内未执行完成；</li>
<li>BroadcastQueue Timeout：比如前台广播在10s内未执行完成</li>
<li>ContentProvider Timeout：内容提供者,在publish过超时10s;</li>
<li>InputDispatching Timeout: 输入事件分发超时5s，包括按键和触摸事件。</li>
</ul>
<p><strong>APP的反应</strong></p>
<ul>
<li>对于前台服务等，会弹出ANR的弹框，提示用户是否关闭APP。</li>
<li>对于后台服务,代码中通过isSilentAnr来判断，会直接杀死进程</li>
<li>Oppo、Vivo等机型的手机由于对系统源码做了更改，当发生ANR的时候，即使是处于前台，也不会弹框，而是收集完Trace以后直接杀死进程</li>
</ul>
<p><strong>ANR的常见原因</strong></p>
<ul>
<li>主线程执行耗时任务。主线程执行大量计算，进行大量的更新UI的操作。</li>
<li>主线程被锁阻塞： 主线程执行IO操作，网络操作导致阻塞。主线程处于blocked状态，有waiting to lock等字样。</li>
<li>cpu被其他APP抢占，可能CPU的使用率飙到500%</li>
<li>系统服务超时：系统服务超时一般会包含BinderProxy.transactNative关键字。系统的服务都是Binder机制（16个线程），服务能力也是有限的，有可能系统服务长时间不响应导致ANR。如果其他应用占用了所有Binder线程，那么当前应用只能等待。</li>
</ul>
<p><strong>遇到的ANR原因</strong></p>
<ul>
<li>WebView的初始化。</li>
<li>主线程的IO操作。<ul>
<li>皮肤下载后的启用。从文件中读取皮肤文件所产生的在主线程的IO。</li>
<li>UI 线程使用SharedPreferences，因为第一次使用sp需要加载一下xml文件。使用MMKV、或者在后台提前一下使用sp，让xml文件先加载出来。</li>
<li>主线程加载so库。整理so库加载，放到子线程。</li>
</ul>
</li>
<li>主线程进行Binder通信<ul>
<li>通过Binder 和System Server进程通信，由于SystemServer繁忙导致一直等待返回结果，引发ANR。这个暂时没啥办法。</li>
<li>APP为双进程，后台进程进行网络请求且存储了APP许多基本信息。解决办法为：使用MMKV进行进程数据共享，将不影响业务的进程通信放到后台，确定后台进程的性能瓶颈并进行优化。</li>
</ul>
</li>
<li>Application等待Fresco 初始化。</li>
</ul>
<p><strong>ANR监控</strong></p>
<ul>
<li>可以通过sigaction来监控sigquit信号来实现ANR监控的目的。</li>
<li>需要注意默认sigquit信号是blocked的，因此信号只能走到SignalCatcher监听中，SignalCatcher是每个进程都存在一个线程专门用来接收和处理sign信号的。通过pthread_sigmark方法把sigquit信号设置为unblock以后，sigaction注册的回调才能监听到信号。</li>
<li>但是需要注意，发生ANR的时候一定会收到sigquit信号，但是收到sigquit信号后不一定发生了ANR。因此存在一定的数据偏差。</li>
</ul>
<p><strong>ANR监控误报</strong></p>
<p>有两点主要的误报：</p>
<ul>
<li>其他进程的ANR：某个进程发生ANR，所有的进程都会收到sigquit信号，因而监听到其他进程的ANR，产生误报。</li>
<li>非ANR发送的sigquit，其他事件也能发送sigquit，比如说kill事件。</li>
</ul>
<p>解决误报：</p>
<ul>
<li>当发生sigquit的时候，20s内轮训No_responsing状态，那就证明发生了ANR。而且sigaction注册的sighandler参数中，有关于发送方进程的信息。因此可以解决以上两个误报问题。</li>
</ul>
<p><strong>ANR漏报</strong></p>
<p>进程处于no_responsing状态可以确定是发生了ANR，但是发生ANR并不一定会设置为not_responsing。如下所示：</p>
<ul>
<li>后台ANR，后台ANR不会标记not_responsing,而是被判定为silentANR，直接杀死进程。因此会漏掉</li>
<li>闪退ANR：一些机型比如说vivo  oppo即使是前台ANR，也会直接崩溃。</li>
</ul>
<p><strong>最完美的方案</strong></p>
<ul>
<li>收到sigquit信号后，通过ActivityManager.getRunningAppProcess()看是否获取到进程状态，如果获取不到，排除掉发生了crash，那么就证明是发生了ANR。</li>
</ul>
<p><strong>堆栈捕获工具</strong></p>
<ul>
<li>初级工具：ASM方法插桩，在每个方法的方法头和方法尾部插入统计代码，通过Trace工具生成火焰图。编译阶段过滤有可能内联的方法，运行阶段通过配置控制采样的堆栈深度、采样数量等阈值。</li>
<li>进阶工具：通过模仿Debug.setMethodTraceSampling()进行采样。在c++层面自己实现 挂起线程-&gt;堆栈采样-&gt; 恢复线程的流程，完成对当前线程的堆栈采样。这样不需要暂停所有线程，只需要挂起采样的线程即可。</li>
</ul>
<h2 id="线程池合并工具"><a href="#线程池合并工具" class="headerlink" title="线程池合并工具"></a>线程池合并工具</h2><p><strong>背景</strong></p>
<p>通过做冷启动发现，并发过多的线程会影响冷启动的速度。于是我就考虑在APP运行期间如果并发了很多线程应该也会影响CPU的执行。因此对线程的使用进行了统计，发现APP在运行阶段有200+个线程存活，因此考虑将这些线程归并到一个线程池中，统一管理会不会更好一些。</p>
<p><strong>手段</strong></p>
<ul>
<li>通过ASM扫描出所有线程的使用，然后根据一定规则配置白名单和黑名单。</li>
<li>通过ASM插桩工具，替换APP内所有线程池和线程的创建过程，接管到自己的Proxy代理类中，然后在这里控制使用统一的线程池。</li>
<li>另外开辟两个线程，专门用来创建新的线程，避免了主线程创建线程导致的性能开销</li>
<li>将每个线程占用1M的内存空间改为500K减少内存的占用。</li>
</ul>
<p><strong>结果</strong></p>
<p>结果对内存占用、线程数、ANR和崩溃率都有一定的正向贡献。</p>
<h2 id="线上类覆盖率工具"><a href="#线上类覆盖率工具" class="headerlink" title="线上类覆盖率工具"></a>线上类覆盖率工具</h2><p><strong>背景</strong></p>
<ul>
<li>在做包大小优化的时候有做一部分业务下线的工作，但是发现对于业务代码在线上的使用情况无法透彻的了解，因此想要开发一个线上类级别的覆盖率工具。</li>
<li>最开始想到的是插桩每个类的static init代码，但是发现存在性能问题且会增加包大小。</li>
<li>于是通过收集资料，偶然发现高德地图做过一个性能无损的线上类覆盖率工具，根据他们技术博客的思路，将覆盖率工具复刻出来。</li>
</ul>
<p><strong>方案</strong></p>
<ul>
<li>所有类的收集通过反射获取DexClassLoader中的pathList字段，获取到所有类。</li>
<li>然后根据深入研究代码，发现通过findLoadedClass()判断类是否加载时，如果传入的是BaseDexClassLoader返回的肯定为true。</li>
<li>方案就是通过自定义classLoader然后将DexClassLoader的classTable复制过去，就可以通过自定义classloader的findLoadedClass()判断是否被加载。</li>
<li>这个方案我攻克了技术难点以后，将整个流程分为三大块：数据验证、数据收集、数据可视化。并将其分配给其他三个同学执行，最终完成了整个技术流程。</li>
</ul>
<h2 id="settingSDK"><a href="#settingSDK" class="headerlink" title="settingSDK"></a>settingSDK</h2><p><strong>背景</strong></p>
<p>刚接手Settingsdk时发现一些问题：</p>
<ul>
<li>代码稳定性不高，总会被人提出一些小bug。</li>
<li>代码极难维护业务执行代码全部是通过Javapoet在编译阶段生成，非常不直观。</li>
<li>创建了大量的类。</li>
<li>没有趁手的debug工具。</li>
<li>本地ab分桶策略有问题</li>
</ul>
<p><strong>方案</strong></p>
<ul>
<li>将Settingsdk的静态代理方案换成动态代理，完全参考retrofit的视线原理，将编译期注解替换成运行时注解，实现了在SDK能直观看到真实的代码执行流程。</li>
<li>性能：动态代理利用反射调用，但是通过查看生成的动态代理类，发现在类加载阶段Method都生成了，所以最耗时的阶段是这个类的加载，因此在APP一启动的时候现在后台线程加载这个类，就会解决这个耗时问题。</li>
<li>本地ab实验重新规划分桶规则。之前在流量扩大以后，重新分桶，导致之前命中a的流量扩大以后却命中了b，和预想不符，因此重新规划分桶规则。</li>
</ul>
<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p><strong>背景</strong></p>
<p>默认的系统ServiceLoader有一些问题：</p>
<ul>
<li>在运行期间加载meta-inf中的文件，每行解析，耗时，且容易出现主线程IO问题。</li>
<li>使用反射创建对象，一定程度上损耗性能。</li>
<li>每次取值都需要创建几个无用的对象。</li>
</ul>
<p><strong>优化</strong></p>
<ul>
<li>编译期通过meta-inf中的文件内容，生成一个类，相当于是对象工厂，可以根据class去匹配创建类的对象。</li>
<li>公开获取所有类的接口，在冷启动初始阶段就去加载，防止出现主线程突然大量加载类的情况。</li>
<li>更改实现方式，使得使用缓存时不创建新对象。1000次测试性能提升50%。</li>
</ul>
<h2 id="MVI-重构"><a href="#MVI-重构" class="headerlink" title="MVI 重构"></a>MVI 重构</h2><ul>
<li><p>MVC 的问题是View和Model是杂糅到一起的，甚至一般把Activity作为Controller的时候，和Controller也杂糅到了一块。</p>
</li>
<li><p>然后MVP通过Presenter将M和V完全隔离开了，但是存在的问题就是P会急剧膨胀，且每次新增都要写一堆代码。</p>
</li>
<li><p>然后MVVM通过ViewModel自动的进行双向通信，解决了P的问题。但是还是没解决有很多歌livedata的问题，业务逻辑会分散开。比如说一个按钮的显示和隐藏需要依赖于5个livedata的值，那么就要监听这5个LIVEDATA，然后再做逻辑，代码非常不好管理。</p>
</li>
<li><p>因此引入MVI单向数据流，以Intent的方式进行。核心是单向数据流。View通过Intent告诉ViewModel自己的行为，然后ViewModel通过背后的Model计算，通过State更新给View去执行什么操作。</p>
</li>
<li><p>比如说这个贴吧列表，列表的工作职责就是增删改，它不需要关心其他逻辑，因此当有事件发生时，比如说用户点击不感兴趣需要删除某个贴吧卡片，那么列表只需要通过Intent告诉ViewModel我要删除postid&#x3D;xxx的卡片，请帮我执行即可。ViewModel执行完成后，更新State，然后列表根据State的diff进行更新自己即可。</p>
</li>
<li><p>这个MVI架构和React Native的redux管理框架非常类似。以上面的贴吧列表为例，集中管理一个State，作为列表状态，当状态更新后通知UI进行diff刷新。Redux发送的是Action作为更新State的触发条件。</p>
</li>
<li><p>直播间按钮管理的方案不是纯正的MVI，但是借用了很大一部分MVI的思想，它不是Intent驱动的，而是由非常多的状态触发，然后再ViewModel统一处理，处理完成后发送给View自己的显示或者隐藏状态，而这个处理逻辑完全可以在子线程中执行，很大程度避免了主线程的各种逻辑判断。</p>
</li>
</ul>
<h2 id="定位模块"><a href="#定位模块" class="headerlink" title="定位模块"></a>定位模块</h2><p><strong>定位权限</strong></p>
<ul>
<li>android 6 以下，不用动态申请定位权限，就能获取到所有定位权限。</li>
<li>Android6 - Android 10，动态申请权限，大致位置和精确位置两个权限。理论上同一个权限组的，申请了一个权限后，另一个自动生效，但是在部分机型上，只请求大致位置权限，无法获取经纬度信息，因此要补充精准定位权限。</li>
<li>Android 10 新增后台定位权限，申请到普通定位。可以大致位置、精确位置、后台位置同时申请，弹框中会给选择。</li>
<li>Android 11 不能同时申请三个定位权限，只能先申请大致、精确位置，然后再申请后台位置权限，不会在弹框中获取权限，。不过大致位置和精确位置同时申请，获取权限后可同时使用。</li>
<li>Android 12 同时申请大致、精确位置时，会有弹框让选择是精确位置还是大致位置。</li>
</ul>
<p><strong>获取定位</strong></p>
<p>google Service服务升级到21了，可以通过一下方式获取位置</p>
<ul>
<li>getLastLocation()  获取最近一次位置，不需要重新计算，但是有可能获取不到。</li>
<li>getCurrentLocation()  获取当前位置，触发重新计算</li>
<li>requestLocationUpdates() 请求位置更新，尽量使用getCurrentLocation() 来替换，否则可能位置未开启时引发大量耗电。</li>
</ul>
<p><strong>解决的问题</strong></p>
<ul>
<li>权限问题：某些机型只获取模糊定位权限后，无法拿到定位，需要再申请精确定位权限。</li>
<li>getLastLocation拿不到位置，需要强制更新一下</li>
<li>时序问题。请求权限-&gt;权限获取成功-&gt;开始定位-&gt;定位获取成功-&gt;上传位置信息-&gt;上传成功-&gt;拉取依赖位置的接口。正常逻辑是这样的，但是很多人讲上传位置和拉取接口放到了同时进行，因此经常会被测试提bug。</li>
</ul>
<h2 id="Push模块"><a href="#Push模块" class="headerlink" title="Push模块"></a>Push模块</h2><p><strong>问题</strong></p>
<ul>
<li>之前Push模块在接收到通知以后，调用路径不明确，经常会出现疑问：为什么这个Push收到以后不弹框，为什么另一个会弹框？为什么这个Push显示这个样式，那个Push显示另一种样式。</li>
<li>线上也无法获知为什么某些场景的某些Push不展示。虽然这些能够通过读代码一点一点的找到原因，但是每次排查问题真是非常耗费精力，且开发者添加一些Push场景的时候根本不知道加到哪里合适。</li>
</ul>
<p><strong>重构</strong></p>
<ul>
<li>使用策略模式重构代码，每个通知分配一个中断策略和显示策略</li>
<li>建立完整的链路监控，任何Push的调用链路完全。</li>
</ul>
<h2 id="jacoco"><a href="#jacoco" class="headerlink" title="jacoco"></a>jacoco</h2><p><strong>介绍</strong></p>
<ul>
<li>该工具针对开发者是在代码提交阶段检测自己本地的增量代码覆盖率情况，如果覆盖率不达标则拒绝提交。</li>
<li>该工具针对测试者是查看测试周期的代码覆盖率情况，测试完成后会将覆盖率情况反馈给开发，让开发衡量是否有没有测到的风险。</li>
</ul>
<p><strong>方案</strong></p>
<ul>
<li>AST抽象语法树查找增量diff</li>
<li>改造后的增量jacoco负责插桩。</li>
</ul>
<h2 id="uetool"><a href="#uetool" class="headerlink" title="uetool"></a>uetool</h2><ul>
<li>依托饿了么的视图检测SDK和美团的mock工具结合，生成了一键检测UI的功能。</li>
<li>两个链路：自动mock成功后，可以拉取设计图到客户端进行比对，也可以将客户端的截图拉到服务端进行比对。</li>
</ul>
<h2 id="美团性能优化"><a href="#美团性能优化" class="headerlink" title="美团性能优化"></a>美团性能优化</h2><ul>
<li>视图层面的优化，减少视图层级，对一些ViewModel懒加载</li>
<li>模块化框架改造，模块分级加载，只先加载首屏的模块，后续模块慢慢加载。</li>
<li>网络优化，在上一页就开始加载数据。</li>
<li>性能监控体系，就是通过一个循环脚本不断触发APP的各个页面，并将其收集起来绘制成图。</li>
</ul>
<h1 id="假大空"><a href="#假大空" class="headerlink" title="假大空"></a>假大空</h1><p><strong>为什么从美团离职</strong></p>
<ul>
<li>当时从美团离职主要是因为美团到餐的业务本身已经是个很成熟的业务了，感觉在工作中能够接触到的新的东西在变少，可以做的事情也在减少。因此想要做一些较大程度的技术提升，因此当时找工作的时候就是往性能优化、基建等方向去找，因为像性能优化这个东西领域是非常深的，而从中得到的提高也是很多的。同时技术上的进步能够带来很多根本上的升级，比如说做完性能优化后，你在正常开发业务需求的时候就会去考虑怎么样减少性能损耗。你也回去考虑如何在负责一个模块的时候保证其稳定性。这些东西在美团当时的那个组难以接触到，所以想着就去外面看看机会。</li>
</ul>
<p><strong>为什么从BIGO离职</strong></p>
<ul>
<li>公司业务发展比较成熟了，可做的事情也不多了，比如冷启动优化，优化完成以后目前一年多也没有发生大规模的劣化，因此相对来说可做的事情在慢慢变少。</li>
<li>相比之下还是想去更大的平台去不断进步，避免技术上的一叶障目，需要不断去探索新的边界。只有逃离舒适区才能有更大的进步。</li>
<li>第三个就是BIGO没有完善的晋升机制，对个人的发展还是会有影响的。</li>
</ul>
<p><strong>项目一般是由谁来推动的</strong></p>
<ul>
<li>对于性能优化这些任务，是技术指标进行驱动。比如说冷启动优化、包大小我们会持续跟踪跟竞对的差距，比如说ANR，因为我们是在Google平台上线的，Google给的推荐ANR率为0.8，这样推荐排名会靠前，因此我们就会去不断地去优化。</li>
<li>对于业务需求和一些SDK的功能，一般是产品推动</li>
<li>而对于一些代码架构调优、重构、优化则是在进行业务需求开发的时候自己推动的不断进步。</li>
</ul>
<p><strong>有什么机制来保证ANR、crash等指标的稳定性</strong></p>
<ul>
<li>我们有完善的ANR、crash率的监控</li>
</ul>
<p><strong>anr优化目标</strong></p>
<p><strong>说一下你认为你的优点</strong></p>
<ul>
<li>在工作方面，我觉着优点就是喜欢钻研技术，喜欢读技术博客，也喜欢写技术博客，对于好多看到的比较好的博客，会忍不住把方案给实现出来，并判断是否能在生产环境中使用。另外也能经常冒出一些比较创新的想法。</li>
<li>还有一点应该就是有责任心，我负责的模块，我都会把他建设成为一个非常稳定的，且有足够监控、报表作为数据支撑的模块。所以经常刚开始接手某个模块后，总会被提零星的小问题，后面提问题的人就消失不见了，因为模块实现了真正的稳定性。</li>
</ul>
<p><strong>说一下你认为你的缺点</strong></p>
<ul>
<li>我觉着目前工作上一个缺点就是不太会拒绝人。比如说产品经理进行一些需求的调整，按照正常流程，都得需要产品经理写变更申请，然后重新估时再流转到我们开发这边，不过很多时候产品给提出一些合理的变更，我也就直接修改了，本意就是流程过于复杂的话也影响各端的开发效率。不过这块也被leader说过，这样的话线上的责任与风险就会被转移到我们身上，不应该说是一个很好的习惯。</li>
</ul>
<p><strong>你对加班的看法</strong></p>
<ul>
<li>因工作需要导致的加班我觉着都没啥，毕竟互联网公司，加班大家都习惯了。不过比较不喜欢的就是为了攒工时进行的无效加班，本身这块的话就是一个时间的浪费。要么就是说多工作一些能绩效好一些，要么就是说下班去放松放松，攒工时的无效加班感觉是没必要。</li>
</ul>
<p><strong>你的职业规划是什么</strong></p>
<ul>
<li>我的规划可以分为两个方向，一个是技术的广度，一个是深度。广度的意思就是我要知道很多技术体系的知识，可以不用知道那么深，但至少有一定的了解，这个相当于是我以后解决问题的一个工具包，因为当遇到一些问题的时候，如果你不知道某个东西，可能压根不会往那个方向去想，当你知道了某个方向是可能可以解决的，那么这才为后面的解决创造条件。同时，要对某个领域有绝对的深度，因为这才是一个人在工作中最核心的竞争力，从跟随者到引领者。所以后面我希望能在某个方向上能有比较大的成果，然后成为某个领域的专家，然后能够带领团队做更多的事情。</li>
</ul>
<p><strong>你朋友对你的评价</strong></p>
<ul>
<li>脾气好，基本上跟谁都能相处得来，并不会说有冲突的时候急吼吼的，比较有耐心和逆商。</li>
</ul>
<p><strong>如果工作一段时间发现不适合，你会怎么办</strong></p>
<ul>
<li>正常情况下不会出现这种情况，因为投递简历的时候对岗位职责也是有比较清楚的了解。</li>
<li>如果出现了感觉不适合的情况，那就要具体原因具体分析了。如果是领导的风格不合适，那这种情况基本也不存在，我跟绝大部分人还是很容易能相处得来的。如果是工作方向和工作难度的问题，这个就是要考虑到一个学习能力的问题了，因为作为程序员一个很核心的竞争力也就是学习能力了，你搞得懂的东西别人不容易搞懂，那么这就是你的能力。因此我相信如果深度钻研，应该是可以克服的。比如说我刚来BIGO这边之前对音视频相关技术了解为0，那么就是刚开始的几个月我比别人都下班晚好多，后面经过了几个月，发现我成为了组里面可以说最了解音视频开发技术的人。</li>
</ul>
<p><strong>最能概括你的三个词</strong></p>
<ul>
<li>耐心</li>
<li>责任</li>
<li>稳定</li>
</ul>
<p><strong>你在选择工作的时候更看重什么</strong></p>
<ul>
<li>首先是要做的事情，并不是说一定要完全能够对接之前做的东西，而是说能够不断地突破，能够不断地去做探索，而不是在当前固有的领域不断地重复。比如说我在BIGO就是有很多独创的东西在。</li>
<li>其次是一个未来发展的前景，不仅是个人技术能力，还有其他各个方面，比如说解决问题得能力都要有很大的提升。</li>
<li>然后就是技术氛围，一个相对自由的技术氛围能够让人提升更多，而不是一直被圈在条条框框里，像一个螺丝钉一样。感觉更应该去不断地思考，如果有新的想法了，能够有机会去实现我觉着是最合适的。</li>
</ul>
<p><strong>拿了几个offer了</strong></p>
<ul>
<li>目前美团是我投递的第一家公司，主要也是比较认同美团的整体技术氛围，特别是之前学城上的海量的学习资源还是很有吸引力的。</li>
</ul>
<p><strong>遇到的比较困难的问题</strong></p>
<ul>
<li>技术上遇到的比较大的难题是就是jacoco覆盖率工具，LineNumberTable 。</li>
<li>心理上遇到比较大的难题是刚接手冷启动优化的时候，梳理代码时发现一般业界常用的优化手段都基本用上了，一时间感觉手足无措，而且leader对我抱有很大的期望，就是因为广州团队没有做的很好，才交过来的。所以心里压力还是蛮大的，后来经过个把月的探索、试错，慢慢就走出来了，不断找到新的方案，然后慢慢对这块有越来越多的新点子。然后有了这个经验，也掌握了很多更深层的技术原理，并且扩大了自己的开发工具包，对后面其他业务的优化有很大的帮助。</li>
</ul>
<p><strong>如果和领导意见不一怎么办</strong></p>
<ul>
<li>首先，表达自己的观点和理由是十分必要的。当意见不一的时候，肯定不能憋在心里，而是要表达出来自己的方案，因为后面即使可能不用，那么说不定其中也会有比较不错的点子能提取出来。</li>
<li>其次如果表达出来后领导仍然不会采纳，那么就按照领导的意思来，因为毕竟人站的一个高度不一样，可能他会有一些更加全局的考量。</li>
</ul>
<p><strong>谈谈对跳槽的理解</strong></p>
<ul>
<li>正常的跳槽促进人才的流动和各个企业之间的技术融合，但是过于频繁的跳槽对个人和企业的发展都是不利的。</li>
</ul>
<p><strong>谈谈对行业的发展</strong></p>
<ul>
<li>目前来说大部分领域是出于一个比较成熟的阶段，各大互联网企业都有自己的基本盘，然后会以自己的基本盘为基准向外不断扩散业务，扩大影响。比如说美团向海外外卖、字节也是在不断地出海等。</li>
<li>成熟期相对于迅猛发展期更考验企业的各项能力，因为投融资环境相比不会那么激进，因此更需要对行业进行精雕细琢，需要企业不断减少试错的成本。当然如果探明一个方向，我相信各大互联网公司仍然会不遗余力的去做。</li>
<li>目前比较火的AI领域应该仍然会再催生出许多玩法，不过相对来说AI更依赖于算法，而对客户端的依赖会弱很多。</li>
</ul>
<p><strong>工作过程中，哪点对你阻碍比较大</strong></p>
<ul>
<li>我觉着应该是公司对技术的一个自由度。有时候去钻研一个问题时候，遇到需要其他库权限的问题时，我还是比较喜欢去看源代码钻研的。不过有时候有的远吗为了安全起见不开放，所以这块就感觉会有点遗憾，然后就只能探索一些业界公开的方案。</li>
</ul>
<p>** 你觉着哪个地方是你能提升的点**</p>
<ul>
<li>首先技术能力要不断提升</li>
<li>其次就是见识、眼光也需要提升，毕竟站得高看的远，因此很多leader考虑问题的方式，方向都是值得不断学习的。</li>
</ul>
<p><strong>问面试官的问题</strong></p>
<ul>
<li>业务未来预期的发展规模。</li>
<li>目前的一个晋升机制。</li>
<li>业绩考核的周期。</li>
<li>团队主要是做什么的，团队的技术栈。</li>
<li>团队的当前规模和未来规模，还有团队的技术氛围，团队总的技术发展方向。</li>
<li>工作时间</li>
<li>从字节的开源能力和优质博客可以看到整体技术氛围还是不错的，因此这块我感觉我可以不用问了。那我就想简单了解一下集团对tiktok lite的一个定位和重视程度吧，后面有没有可能说在整个用户体量方面能够超过主APP  tiktok。</li>
<li>还有未来的一个团队规模。</li>
<li>tiktok lite 在集团里的一个角色，或者称之为被重视的程度。</li>
<li>团队的工作氛围</li>
</ul>
<p><strong>刚入职如何开展工作?</strong></p>
<p>1、首先是熟悉团队，包括团队中的同学，和团队做的方向。通过跟之前的面试官聊，我基本了解到目前团队并不是缺了某个岗位的人而招聘，而是各个方向上都可能有一定的需求。从聊的情况来看，目前团队大致分为性能优化、动态化、业务等方向，所以最初刚进入团队后，需要对团队各个方向做的事情有一定的理解。<br>2、基本了解团队做的事情的时候，应该是根据团队的一个需要，还有自己擅长的领域选择一个主要的方向，以该方向作为工作的重心。<br>3、选定方向后，就是熟悉该方向，包括业务上的和技术方面的。要了解业务对该方向上的一个诉求和该方向的能力对业务有什么贡献。然后技术方面的话，我应该会先去了解一下相关的工具包，然后再对技术栈进行深入了解。<br>4、对于对技术栈的了解，我认为以具体的case开始可能比较目的性强一些，通过比如说解决某个问题、开发某个功能，慢慢对技术栈就会熟悉起来。慢慢熟悉后我认为就会可能有一些创新的东西出来，因为熟悉是创新的一个基础。慢慢的，应该这个工作就会全面铺开。</p>
<p><strong>和你职业生涯的契合点</strong></p>
<p>1、 我觉着字节在技术领域的探索应该是很深入的，确实学习过字节的好多开源库，包括我们公司的APP也在使用字节的一些开源的SDK，所以，我觉着字节的技术氛围对我的职业生涯是个很好的助力。<br>2、我认为我对技术的探索是非常感兴趣的，包括各大厂商的技术博客、开源库，我都会经常去分析，比如说我简历里的线上类覆盖率工具，就是看了高德地图写的一个技术博客，感觉思路很不错，然后就将其复刻出来了。<br>3、当然，我也算是做业务出身的，因为在美团的较大部分工作也是进行业务开发，所以能够明白技术的最主要目的也就是为了支撑各业务的发展，所以我觉着我应该要成为一个懂业务的并且有技术深度的人。<br>4、在技术领域深度方面我觉着不拘一格，因为各技术方向很多思想都是想通的。比如说更上层的leader可能对技术细节上可能并没有一线的开发了解的细，但是领域思想还是能指引前进方向的，所以我认为这也是我努力的一个方向吧，在某个领域有深入的见解。</p>
<p><strong>和岗位的匹配度</strong></p>
<p>1、我觉着我对当前的这个岗位匹配度是极高的，因为我们BIGO主APP也是在做的直播和短视频的，对业务的一个理解我觉着有很多想通的地方。其次技术栈方面，也是存在很多重叠的地方，比如说我们在进行冷启动优化的时候直播对标就是对标的tiktok。</p>
<p><strong>你有其他的offer吗，有啥优缺点</strong></p>
<p>字节HR的推进效率是特别高，本来美团、京东的面试都在前面，现在也被赶上了。美团目前已经让我提交薪资和流水了，京东4面+HR面刚面完，上周问HR，说通过了，即将推进进一步流程。小米效率比较低，在约4面技术面，拼多多周日的时候HR面了。</p>
<ul>
<li>美团的岗位主要是境外的外卖业务，优点就是岗位匹配度相对较高，面试的岗位是性能优化方向的，境外业务使用的技术栈和国内还是有一定差异的，且外卖业务对他们来说也是核心业务。缺点就是领域跟现在做的不够垂直，因为毕竟也是在音视频这块多年。</li>
<li>京东的优点则是做音视频，他们的这个线也是刚开不久，所以应该有很多事情要做，对于很多0-1的东西还是比较考验人的技术能力的。缺点的话，京东在技术方面并没有看到很多开源库和一些优质的技术博客，所以，对团队的技术氛围可能会稍差一些。</li>
<li>拼多多这个就是优点是主APP，且是性能优化方向，但缺点就是从了解上来看，拼多多的自由度比较低一点，在里面可能更多的是照章办事，创新度可能会少一些。</li>
<li>小米的话，岗位匹配度比较低一些，他们使用c++开发一些系统级的需求，这个即是优点也是缺点，优点是我也能对一个新的领域有一些深刻的了解了，因为从他们面试态度上看，并没有说是因为岗位匹配度低而直接中断面试、甚至在简历筛选阶段直接pass，所以我觉着我的一些能力还是他们所希望有的吧。然后缺点就是领域不够垂直，相当于是开启新的领域了。</li>
<li>字节的优点是领域垂直、匹配度极高、技术氛围好。缺点目前还没想想到，目前对字节这个岗位还是最偏向的。</li>
</ul>
<p><strong>如果给offer，多久到岗</strong></p>
<p>10月中下旬</p>
<p><strong>对你上一份工作进行一些分析，不过不是太深入的专业问题</strong></p>
<p>BIGO 可以认为是一家直播和短视频公司，我们公司90%的营收和净利润都是从BIGO LIVEAPP里出来的，这个也就是我们维护的主APP。其中最主要的就是直播，其次是贴吧短视频功能，然后去年也发力做了一些陌生人社交的功能。不过主要的营收也还是直播，主要收益来源于：美国和日韩等发达国家、东南亚和中东。<br>我这边的主要工作可以分为三块性能优化、SDK维护、业务需求开发。</p>
<ul>
<li>性能优化主要就是对冷启动XX等技术指标进行优化。当然这些优化的结果最终都要反馈到业务指标上，这块也是工作的难点，特别是ANR优化，可以说是业界公认的难以解决的问题。</li>
<li>第二部分是SDK的维护，相当于为各个APP提供一些工具包和基础能力，这块工作相当于服务者，服务的对象就是全公司的Android客户端开发，要把SDK做的大家都爱用且稳定，如果设计的api不是那么好用，来回沟通的成本也是很高的，另外这里也需要一个内部的自我优化，对于内部的框架调整和优化可以说是提效的一个关键，不仅提高可维护性、稳定性，还要增加便捷性。</li>
<li>第三部分是业务需求的开发了，这块开发和沟通都是占很大比重的，要和产品、测试、设计、后端、iOS多方沟通对齐。当然这块也存在一些自驱力，遇到一些混乱的代码架构要主动去申请资源优化，比如说我建立上写的直播间多功能按钮，就是以我为出发点向外推进的，把多功能按钮变得很稳定。可以说架构的调整是一个非常有利的增效的办法。</li>
</ul>
<p><strong>之前公司的优缺点</strong></p>
<ul>
<li>进入之前聊了很久，主管对我的期望是不设限，所以我当时也能接触到很多东西。相对来说，公司在做事方面很开放，只要你有idea，就可以去做相关的时间。整体bigolive的话，虽然整体体量没有tiktok大，但是还是有一定的基本盘的。要说缺点的话，就是我们的技术团队并没有那么多人，因此很多技术的尝试无法有很大的精力投入，比如说动态化方向，我跟leader提过很久，只不过确实没有很多人力去搞这块。</li>
<li>对比之下，字节对技术体系的投入应该是很大的，也开源了好多开源库，而且用户的体量也是比bigolive大很多的，这带来的是更加具有挑战性的事情。</li>
</ul>
<p><strong>业余爱好</strong></p>
<ul>
<li>看书，最近看明朝那些事，正在看曹操传</li>
<li>目前是喜欢游泳，加入公司的游泳俱乐部，一周游一次</li>
</ul>
<p><strong>未来1-3年阻碍你发展的可能因素是什么</strong></p>
<ul>
<li>我觉着应该算是权限问题吧，因为我算是一个比较喜欢探索的人，虽然我们在进行常规工作中用不到底层音视频SDK里的技术，即我们使用音视频SDK提供的服务。从跟前面面试官聊的过程中，我也了解到应该是类似的这种模式。然后我又很好奇音视频SDK底层到底是如何实现的，然后我就去申请权限，但是公司对这块权限管理严格，相当于是一直不给。所以我只能从开源库中去学习。当然对于设置这种权限机制公司肯定是有自己的考量的，不过相对来说每个公司都有自己的风格。我是很喜欢字节的一个开源文化的，字节公众号经常发的技术博客还有一些开源库，我都有不断的在学习，所以我觉着越开放的环境对我的成长越有利。</li>
</ul>
<p><strong>工作中你难以和同事、上司相处，你该怎么办</strong></p>
<ul>
<li>我觉着应该以我的性格不会存在这种情况。之前有个我比较熟悉的猎头，我一般向他打听部门leader的风格啥的，他跟我说，你感觉不用打听这些，你跟谁都能相处得来。</li>
</ul>
<p><strong>假设你在某单位工作，成绩比较突出，得到领导的肯定。但同时你发现同事们越来越孤立你，你怎么看这个问题？你准备怎么办？</strong></p>
<ul>
<li>工作成绩好是好事，证明能力不错</li>
<li>当然要考虑到一些共享精神，比如说我们团队北京这边大部分同学做业务，</li>
</ul>
<p><strong>加班的看法</strong></p>
<ul>
<li>企业快速增长期，抢占市场加班是很正常的</li>
<li>程序员视角来看加班应该是个比较习惯的事情了</li>
<li>之前刚进BIGO的时候我们还是大小周，这个感觉是适应企业的一个工作节奏，刚进BIGO的时候因为音视频是个新的领域，所以周末我有时候会自己来公司，学一些新的知识，进而能够快速上手，并成为团队里对音视频了解最多的人。</li>
</ul>
<p><strong>职业规划</strong></p>
<p>我觉着我一直在从技术的广度和深度两个方面对我的个人能力进行铺排。</p>
<ul>
<li>技术的广度是要涉猎很多领域的知识，不需要每个都了解的很细致，但是需要有一定的了解。这样相当于是储备自己的技术工具包，等真正遇到问题的时候就可以想到是否能用某个方向去解决问题。</li>
<li>技术的深度我觉着就是代表着自己的核心竞争力，能够攻克难点，直至能在一定程度上引领某项技术是我非常期望能看到的。</li>
<li>另外，我也清楚技术基本都是为业务服务的，所以在未来的职业发展中，我也期望成为一个懂得业务的技术，而不是只埋头做技术。</li>
</ul>
<p><strong>你朋友对你的评价</strong></p>
<ul>
<li>靠谱+乐于助人，比如举帮安世崇内推的例子。</li>
<li>善于换位思考，并一定程度上能够成为组织者。比如说我们高中同学的聚会，大部分情况下都是我来发起并组织成功。还有大学几个朋友的小聚，各项事情都是我来进行主导。</li>
</ul>
<p><strong>在完成某项工作时，你认为领导要求的方式不是最好的，自己还有更好的方法，你应该怎么做？</strong></p>
<ul>
<li>开放的环境我觉着肯定是允许任何人发表意见的，在某项工作中，如果有更好的idea，那么肯定就会提出来，然后对其进行一个详细的介绍。而leader一般应该也会提出对应的好的地方和不足的地方。如果最后leader还是决定用他的方案，那也没啥，毕竟他考虑问题的角度会更高。当然我觉着我把我的方案提出来以后，如果其中有比较好的地方，leader应该也会吸取。</li>
</ul>
<p><strong>如果你的工作出现失误，给本公司造成经济损失，你认为该怎么办？</strong></p>
<ul>
<li>在进行需求开发，性能优化等工作的时候，实际最重要的事情之一也就是控制好上线风险，所以在上线前对风险一定要谨慎应对。</li>
<li>在上线大规模的改造时，一定要实时关注指标。</li>
<li>如果出现线上事故，第一时间应该解决问题，先把线上风险修复以尽量减少损失。</li>
<li>线上修复后，要对问题进行复盘和职责划分，这块就是要明确职责。</li>
<li>然后就是复盘事故发生的原因、和日后的避免策略，或建立一些有效的机制尽量减少此类事件的发生。</li>
</ul>
<p><strong>对岗位的理解</strong></p>
<ul>
<li>tiktok lite 我也下载了，目前来看用户量也是极大的，不过好像国内不能用，对比发现应该lite相比 tiktok 确实优化了很多。</li>
<li>lite的定位主要是占领中低端市场、运营内容和主APP一致，音视频SDK是有专门的团队开发，目前这个团队是在此基础上进行开发的。</li>
<li>目前客户端可以分为性能、业务、动态化等方向，我面试的岗位并不是一个空缺的岗位，而是团队扩张，各个方向都需要人，这块做哪个方向估计还要进组以后看团队的需要和我擅长的地方。</li>
</ul>
<p><strong>对工作的期望与目标何在</strong></p>
<ul>
<li>字节的技术氛围很期待，字节有很多技术能力很强的大佬，也希望能够以我目前的经验给团队带来新的idea，期望和团队一起能有更新的突破</li>
</ul>
<p><strong>什么会让你有成就感</strong></p>
<ul>
<li>比如在业务上，把杂乱无章的代码给重构后条理清晰，就很有成就感</li>
<li>对预设的一些指标能够很好的完成，就很有成就感</li>
<li>对一些问题的解决想出创新的方法，并实践出来确实很不错，就很有成就感</li>
</ul>
<p><strong>你希望与什么样的上级共事</strong></p>
<ul>
<li>相对来说对技术方面的较为自由的领导吧，即主要深入某个方向的同时，如果对其他方向上的一些优化等有新的idea，那么可以去实践。</li>
</ul>
<p><strong>选择工作时看重什么</strong></p>
<ul>
<li>自己要做的事情</li>
<li>技术平台与技术氛围</li>
<li>平台和方向，未来的一个成长空间</li>
<li></li>
</ul>
<!-- flag of hidden posts --></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://icoderbin.github.io">icoderbin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://icoderbin.github.io/posts/11472/">https://icoderbin.github.io/posts/11472/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://icoderbin.github.io" target="_blank">icoderbin 的小站</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="/css/icon.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/css/wechat.png" target="_blank"><img class="post-qr-code-img" src="/css/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/css/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/css/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bigolive%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.</span> <span class="toc-text">bigolive核心数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c-%E5%BC%80%E5%8F%91"><span class="toc-number">1.2.</span> <span class="toc-text">c++ 开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">1.3.</span> <span class="toc-text">音视频</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%B7%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">冷启动优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E5%A4%A7%E5%B0%8F%E4%BC%98%E5%8C%96"><span class="toc-number">1.5.</span> <span class="toc-text">包大小优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ANR"><span class="toc-number">1.6.</span> <span class="toc-text">ANR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%90%88%E5%B9%B6%E5%B7%A5%E5%85%B7"><span class="toc-number">1.7.</span> <span class="toc-text">线程池合并工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E4%B8%8A%E7%B1%BB%E8%A6%86%E7%9B%96%E7%8E%87%E5%B7%A5%E5%85%B7"><span class="toc-number">1.8.</span> <span class="toc-text">线上类覆盖率工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#settingSDK"><span class="toc-number">1.9.</span> <span class="toc-text">settingSDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPI"><span class="toc-number">1.10.</span> <span class="toc-text">SPI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MVI-%E9%87%8D%E6%9E%84"><span class="toc-number">1.11.</span> <span class="toc-text">MVI 重构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E6%A8%A1%E5%9D%97"><span class="toc-number">1.12.</span> <span class="toc-text">定位模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Push%E6%A8%A1%E5%9D%97"><span class="toc-number">1.13.</span> <span class="toc-text">Push模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jacoco"><span class="toc-number">1.14.</span> <span class="toc-text">jacoco</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#uetool"><span class="toc-number">1.15.</span> <span class="toc-text">uetool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%8E%E5%9B%A2%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.16.</span> <span class="toc-text">美团性能优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%81%87%E5%A4%A7%E7%A9%BA"><span class="toc-number">2.</span> <span class="toc-text">假大空</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>